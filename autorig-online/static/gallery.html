<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Rig Gallery ‚Äî Real Results</title>
    <meta name="description" content="Browse real rigging results from AutoRig.Online. Sort by likes or newest, and explore the full gallery with pagination.">

    <!-- Open Graph -->
    <meta property="og:title" content="AutoRig Gallery - Real Results">
    <meta property="og:description" content="Browse real auto-rigged tasks. Sort by likes or newest, paginate through all results.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://autorig.online/gallery">
    <meta property="og:image" content="https://autorig.online/static/images/og-image.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="/static/css/styles.css?v=gallery-dyn-1">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-T4E781EHE4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-T4E781EHE4');
    </script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-inner">
                <a href="/" class="logo">
                    <img src="/static/images/logo/autorig-logo.png" srcset="/static/images/logo/autorig-logo.png 1x, /static/images/logo/autorig-logo@2x.png 2x" alt="Autorig.Online" class="logo-img" height="120">
                </a>

                <nav class="nav">
                    <a href="/guides" class="nav-link" data-i18n="nav_guides">Guides</a>
                    <a href="/gallery" class="nav-link active" data-i18n="nav_gallery">Gallery</a>
                    <a href="/buy-credits" class="nav-link" data-i18n="nav_buy">Buy</a>
                    <a href="/developers" class="nav-link" data-i18n="nav_api">API</a>
                </nav>

                <div class="header-actions">
                    <!-- Credits Badge -->
                    <div class="credits-badge">
                        <span id="credits-label" data-i18n="credits_free">Free conversions left</span>
                        <span class="count" id="credits-count">3</span>
                    </div>

                    <!-- Language Selector -->
                    <div class="lang-selector">
                        <button class="lang-btn">
                            <span>EN</span>
                            <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                                <path d="M3 4.5L6 7.5L9 4.5"/>
                            </svg>
                        </button>
                        <div class="lang-dropdown">
                            <button class="lang-option" data-lang="en">English</button>
                            <button class="lang-option" data-lang="ru">–†—É—Å—Å–∫–∏–π</button>
                            <button class="lang-option" data-lang="zh">‰∏≠Êñá</button>
                            <button class="lang-option" data-lang="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
                        </div>
                    </div>

                    <!-- Theme Toggle -->
                    <button class="theme-toggle" id="theme-toggle" title="Toggle theme">üåô</button>

                    <!-- Login Button -->
                    <a href="/auth/login" class="btn btn-google" id="login-btn">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        <span data-i18n="btn_login">Sign in with Google</span>
                    </a>

                    <!-- User Info (hidden when not logged in) -->
                    <div id="user-info" class="hidden flex items-center gap-2">
                        <img class="user-avatar" src="" alt="" style="width:32px;height:32px;border-radius:50%;">
                        <span class="user-name"></span>
                        <a href="/auth/logout" class="btn btn-ghost" data-i18n="btn_logout">Sign out</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Free3D Model Search -->
    <section class="free3d-search">
        <div class="container">
            <div class="free3d-search-row">
                <label for="free3d-search-input" class="free3d-search-label" data-i18n="free3d_search_label">Search Free 3D Models</label>
                <select id="free3d-category-select" class="free3d-category-select">
                    <option value="characters" selected data-i18n="free3d_cat_characters">Characters</option>
                    <option value="animals" data-i18n="free3d_cat_animals">Animals</option>
                    <option value="vehicles" data-i18n="free3d_cat_vehicles">Vehicles</option>
                    <option value="weapons" data-i18n="free3d_cat_weapons">Weapons</option>
                    <option value="props" data-i18n="free3d_cat_props">Props</option>
                    <option value="all" data-i18n="free3d_cat_all">All</option>
                </select>
                <div class="free3d-input-group">
                    <input type="text" 
                           id="free3d-search-input" 
                           class="free3d-search-input" 
                           data-i18n-placeholder="free3d_search_placeholder"
                           placeholder="girl, robot, warrior..."
                           autocomplete="off">
                    <button type="button" class="free3d-randomize-btn" id="free3d-randomize-btn" title="Random search">üé≤</button>
                </div>
                <span class="free3d-search-status hidden" id="free3d-search-status" data-i18n="free3d_searching">Searching...</span>
            </div>
            <div class="free3d-results hidden" id="free3d-results">
                <!-- Horizontal scrollable preview strip populated by JS -->
            </div>
        </div>
    </section>

    <main>
        <section class="hero">
        <div class="container">
                <h1 class="text-gradient" data-i18n="gallery_page_title">Gallery</h1>
                <p class="hero-subtitle" data-i18n="gallery_page_subtitle">Real completed tasks. Sort by likes or newest.</p>
            </div>
        </section>

        <section class="container mt-4">
            <div class="card" style="padding: 2rem;">
                <div class="gallery-controls">
                    <div>
                        <div style="font-weight: 700; font-size: 1.1rem;" data-i18n="gallery_all_works">All works</div>
                        <div id="gallery-total" style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.25rem;">‚Äî</div>
                    </div>
                    <div style="display:flex; gap: 0.75rem; align-items:center; flex-wrap: wrap; justify-content:flex-end;">
                        <label style="color: var(--text-secondary); font-size: 0.9rem;" data-i18n="gallery_sort_label">Sort:</label>
                        <select id="gallery-sort" class="form-select" style="width: 220px;">
                            <option value="likes" data-i18n="gallery_sort_likes">Top liked</option>
                            <option value="date" data-i18n="gallery_sort_date">Newest</option>
                        </select>
                    </div>
                </div>

                <div id="gallery-grid" class="gallery-grid-dyn">
                    <div class="card" style="padding: 1rem; color: var(--text-muted);">Loading‚Ä¶</div>
                </div>

                <div class="gallery-pagination">
                    <button class="btn btn-secondary" id="gallery-prev" data-i18n="gallery_prev">Prev</button>
                    <div id="gallery-page" style="color: var(--text-secondary); font-size: 0.9rem;">Page 1</div>
                    <button class="btn btn-secondary" id="gallery-next" data-i18n="gallery_next">Next</button>
            </div>
        </div>
    </section>
    </main>

        <!-- SEO Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <!-- Brand Column -->
                <div class="footer-brand">
                    <a href="/" class="footer-logo">
                        <img src="/static/images/logo/autorig-logo.png" alt="AutoRig Online" height="60">
                    </a>
                    <p class="footer-tagline" data-i18n="footer_tagline">AI-powered automatic 3D character rigging. Upload your model and get it rigged with animations in minutes.</p>
                </div>
                
                <!-- Services Column -->
                <div class="footer-links">
                    <h4 class="footer-heading" data-i18n="footer_services">Services</h4>
                    <ul>
                        <li><a href="/glb-auto-rig" data-i18n="footer_glb_rig">GLB Auto Rigging</a></li>
                        <li><a href="/fbx-auto-rig" data-i18n="footer_fbx_rig">FBX Auto Rigging</a></li>
                        <li><a href="/obj-auto-rig" data-i18n="footer_obj_rig">OBJ Auto Rigging</a></li>
                        <li><a href="/gallery" data-i18n="nav_gallery">Gallery</a></li>
                    </ul>
                </div>
                
                <!-- Guides Column -->
                <div class="footer-links">
                    <h4 class="footer-heading" data-i18n="footer_guides">Guides</h4>
                    <ul>
                        <li><a href="/mixamo-alternative" data-i18n="footer_mixamo_alt">Mixamo Alternative</a></li>
                        <li><a href="/rig-glb-unity" data-i18n="footer_glb_unity">GLB for Unity</a></li>
                        <li><a href="/rig-fbx-unreal" data-i18n="footer_fbx_unreal">FBX for Unreal</a></li>
                        <li><a href="/glb-vs-fbx" data-i18n="footer_glb_vs_fbx">GLB vs FBX</a></li>
                        <li><a href="/t-pose-vs-a-pose" data-i18n="footer_tpose">T-Pose vs A-Pose</a></li>
                        <li><a href="/animation-retargeting" data-i18n="footer_retargeting">Animation Retargeting</a></li>
                    </ul>
                </div>
                
                <!-- Company Column -->
                <div class="footer-links">
                    <h4 class="footer-heading" data-i18n="footer_company">Company</h4>
                    <ul>
                        <li><a href="/guides" data-i18n="nav_guides">All Guides</a></li>
                        <li><a href="/how-it-works" data-i18n="footer_how_it_works">How It Works</a></li>
                        <li><a href="/faq" data-i18n="footer_faq">FAQ</a></li>
                        <li><a href="/buy-credits" data-i18n="nav_buy">Buy Credits</a></li>
                        <li><a href="/developers" data-i18n="nav_api">API</a></li>
                    </ul>
                </div>
            </div>
            
            <!-- Bottom Bar -->
            <div class="footer-bottom">
                <p class="footer-copyright" data-i18n="footer_copyright">¬© 2025 AutoRig Online. All rights reserved.</p>
                <div class="footer-social">
                    <a href="https://t.me/autorigonline" target="_blank" rel="noopener noreferrer" class="footer-social-link" title="Telegram">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                        </svg>
                        <span>Telegram</span>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/static/js/i18n.js"></script>
    <script src="/static/js/task-card.js"></script>
    <script src="/static/js/app.js?v=gallery-dyn-1"></script>
    <script>
        const GalleryPage = {
            page: 1,
            perPage: 24,
            sort: 'likes',
            loading: false,

            async load() {
                if (this.loading) return;
                this.loading = true;

                const grid = document.getElementById('gallery-grid');
                const totalEl = document.getElementById('gallery-total');
                const pageEl = document.getElementById('gallery-page');
                const prevBtn = document.getElementById('gallery-prev');
                const nextBtn = document.getElementById('gallery-next');

                try {
                    grid.innerHTML = `<div class="card" style="padding: 1rem; color: var(--text-muted);">${(typeof window.t === 'function') ? t('gallery_loading') : 'Loading‚Ä¶'}</div>`;

                    const params = new URLSearchParams({
                        page: String(this.page),
                        per_page: String(this.perPage),
                        sort: this.sort
                    });
                    const resp = await fetch(`/api/gallery?${params.toString()}`);
                    const data = await resp.json();

                    const items = (data && data.items) ? data.items : [];
                    const total = (data && typeof data.total === 'number') ? data.total : 0;
                    const hasMore = !!(data && data.has_more);

                    totalEl.textContent = (typeof window.t === 'function')
                        ? t('gallery_total', { count: total })
                        : `Total: ${total}`;
                    pageEl.textContent = (typeof window.t === 'function')
                        ? t('gallery_page', { page: this.page })
                        : `Page ${this.page}`;
                    prevBtn.disabled = this.page <= 1;
                    nextBtn.disabled = !hasMore;

                    if (!items.length) {
                        grid.innerHTML = `<div class="card" style="padding: 1rem; color: var(--text-muted);">${(typeof window.t === 'function') ? t('gallery_empty') : '‚Äî'}</div>`;
                        return;
                    }

                    grid.innerHTML = items.map(it => {
                        const taskUrl = `/task?id=${it.task_id}`;
                        const thumbUrl = it.thumbnail_url || `/api/thumb/${it.task_id}`;
                        const videoUrl = it.video_url || `/api/video/${it.task_id}`;
                        const timeAgo = it.time_ago || '';
                        const likeCount = (typeof it.like_count === 'number') ? it.like_count : 0;
                        const liked = !!it.liked_by_me;
                        const openLabel = (typeof window.t === 'function') ? t('gallery_open') : 'Open';
                        return `
                            <a href="${taskUrl}" class="gallery-card" data-task-id="${it.task_id}" data-video-url="${videoUrl}" style="text-decoration:none;">
                                <div class="gallery-card-media">
                                    <img src="${thumbUrl}" loading="lazy" alt="">
                                    <button class="like-btn ${liked ? 'liked' : ''}" type="button" data-like-task="${it.task_id}">
                                        <span class="like-heart">‚ô•</span>
                                        <span class="like-count">${likeCount}</span>
                                    </button>
                                </div>
                                <div class="gallery-card-meta">
                                    <span class="gallery-time">${timeAgo}</span>
                                    <span class="btn btn-ghost" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">${openLabel}</span>
                                </div>
                            </a>
                        `;
                    }).join('');

                    // lazy fade-in
                    grid.querySelectorAll('img[loading=\"lazy\"]').forEach(img => {
                        const markLoaded = () => img.classList.add('loaded');
                        img.addEventListener('load', markLoaded, { once: true });
                        img.addEventListener('error', markLoaded, { once: true });
                        if (img.complete) markLoaded();
                    });

                    // Like buttons (auth-only)
                    grid.querySelectorAll('[data-like-task]').forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            e.preventDefault();
                            e.stopPropagation();

                            // If not logged in: redirect to login
                            const userInfo = document.getElementById('user-info');
                            const isAuthed = userInfo && !userInfo.classList.contains('hidden');
                            if (!isAuthed) {
                                window.location.href = '/auth/login';
                                return;
                            }

                            const taskId = btn.getAttribute('data-like-task');
                            try {
                                const r = await fetch(`/api/gallery/${taskId}/like`, { method: 'POST' });
                                if (r.status === 401) { window.location.href = '/auth/login'; return; }
                                const d = await r.json();
                                btn.classList.toggle('liked', !!d.liked_by_me);
                                const cnt = btn.querySelector('.like-count');
                                if (cnt) cnt.textContent = String(d.like_count ?? 0);
                            } catch (err) {
                                console.error('Like failed:', err);
                            }
                        });
                    });

                    // Video playback on hover/visibility
                    grid.querySelectorAll('a[data-video-url]').forEach(card => {
                        const media = card.querySelector('.gallery-card-media');
                        const thumb = media?.querySelector('img');
                        const videoUrl = card.getAttribute('data-video-url');

                        const startVideo = () => {
                            if (!media || !videoUrl) return;
                            if (media.querySelector('video')) return;
                            const v = document.createElement('video');
                            v.src = videoUrl;
                            v.muted = true;
                            v.playsInline = true;
                            v.loop = true;
                            v.preload = 'metadata';
                            v.style.cssText = 'position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:1;';
                            media.appendChild(v);
                            if (thumb) { thumb.style.transition = 'opacity 0.15s'; thumb.style.opacity = '1'; }
                            v.addEventListener('playing', () => { if (thumb) thumb.style.opacity = '0'; }, { once: true });
                            v.play().catch(() => {});
                        };

                        const stopVideo = () => {
                            const v = media?.querySelector('video');
                            if (!v) return;
                            try { v.pause(); v.removeAttribute('src'); v.load(); } catch (_) {}
                            v.remove();
                            if (thumb) thumb.style.opacity = '1';
                        };

                        card.addEventListener('mouseenter', startVideo);
                        card.addEventListener('mouseleave', stopVideo);
                    });

                } finally {
                    this.loading = false;
                }
            },

            init() {
                const sortEl = document.getElementById('gallery-sort');
                const prevBtn = document.getElementById('gallery-prev');
                const nextBtn = document.getElementById('gallery-next');

                if (sortEl) {
                    sortEl.value = this.sort;
                    sortEl.addEventListener('change', () => {
                        this.sort = sortEl.value || 'likes';
                        this.page = 1;
                        this.load();
                    });
                }

                prevBtn?.addEventListener('click', () => {
                    if (this.page > 1) {
                        this.page -= 1;
                        this.load();
                    }
                });

                nextBtn?.addEventListener('click', () => {
                    this.page += 1;
                    this.load();
                });

                // Re-render text on language change (and refresh liked_by_me)
                window.addEventListener('languageChanged', () => {
                    this.load();
                });

                this.load();
            }
        };

        document.addEventListener('DOMContentLoaded', () => GalleryPage.init());
    </script>
</body>
</html>
