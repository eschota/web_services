<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Credits | AutoRig.online</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-inner">
                <a href="/" class="logo">
                    <img src="/static/images/logo/logo.svg" alt="AutoRig" class="logo-icon" width="40" height="40">
                    <span>AutoRig</span>
                </a>

                <nav class="nav">
                    <a href="/" class="nav-link" data-i18n="nav_home">Home</a>
                    <a href="/guides" class="nav-link" data-i18n="nav_guides">Guides</a>
                    <a href="/gallery" class="nav-link" data-i18n="nav_gallery">Gallery</a>
                    <a href="/buy-credits" class="nav-link active" data-i18n="nav_buy">Buy</a>
                </nav>

                <div class="header-actions">
                    <div class="credits-badge">
                        <span id="credits-label" data-i18n="credits_remaining">Credits remaining</span>
                        <span class="count" id="credits-count">-</span>
                    </div>
                    <div class="lang-selector">
                        <button class="lang-btn">
                            <span>EN</span>
                            <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                                <path d="M3 4.5L6 7.5L9 4.5"/>
                            </svg>
                        </button>
                        <div class="lang-dropdown">
                            <button class="lang-option" data-lang="en">English</button>
                            <button class="lang-option" data-lang="ru">–†—É—Å—Å–∫–∏–π</button>
                            <button class="lang-option" data-lang="zh">‰∏≠Êñá</button>
                            <button class="lang-option" data-lang="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
                        </div>
                    </div>
                    <button class="theme-toggle" id="theme-toggle" title="Toggle theme">üåô</button>
                </div>
            </div>
        </div>
    </header>

    <main style="padding: 3rem 0;">
        <div class="container" style="max-width: 980px;">
            <!-- FREE Credits Section -->
            <div class="card" style="padding: 2rem; border: 2px dashed var(--accent); background: rgba(var(--accent-rgb), 0.05);">
                <h2 style="margin-top: 0; color: var(--accent);" data-i18n="free_title">FREE</h2>
                <div style="line-height: 1.6;">
                    <p style="font-weight: 600; font-size: 1.1rem; margin-bottom: 1rem;" data-i18n="free_greeting">Hi 3D ARTIST! I've been doing this project with a friend on enthusiasm for over a year and everything is free here!</p>
                    <p data-i18n="free_message">I would like to make the RIG even cooler and I know how, but for this I need MONEY :) for beer and cookies! So if you have a couple of extra bucks, please buy credits!</p>
                    <p style="margin-top: 1rem;" data-i18n="free_youtube_intro">And if not, then just follow the link to my youtube channel and click like!</p>
                    <p style="font-weight: 700; color: var(--accent); font-size: 1.2rem; margin: 1rem 0;" data-i18n="free_credits_offer">Get 10 credits for downloading for free!!!</p>
                    <a href="https://youtu.be/wz8cR6VitF8?si=9l9HO-ssJoRPhbKu" target="_blank" class="btn btn-primary" id="youtube-bonus-link" style="display: inline-flex; align-items: center; gap: 0.5rem; text-decoration: none;">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.377.505 9.377.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                        YouTube
                    </a>
                    <p style="margin-top: 1rem; font-style: italic; font-size: 0.9rem; color: var(--text-muted);" data-i18n="free_feedback_hint">And please leave feedback about the RIG and what you would like to improve in the form below</p>
                </div>
            </div>

            <div class="card" style="padding: 2rem; margin-top: 1rem;">
                <h1 style="margin-top: 0;" data-i18n="buy_title">Buy Credits</h1>
                <p style="color: var(--text-secondary);" data-i18n="buy_subtitle">
                    Credits are needed to download finished 3D models with rigging and all animations.
                </p>
                <p style="color: var(--text-muted); margin-top: 0.5rem;" data-i18n="buy_notice">
                    Credits are added automatically within 1‚Äì2 minutes after payment.
                </p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 1rem; margin-top: 1rem;">
                <div class="card" style="padding: 1.5rem; text-align: center;">
                    <h3 style="margin-top: 0;">100 credits</h3>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--accent); margin: 1rem 0;">$1</div>
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;">$0.01 per credit</div>
                    <button class="btn btn-primary" id="buy-100" style="width: 100%;" data-i18n="buy_btn">Buy</button>
                </div>
                <div class="card" style="padding: 1.5rem; text-align: center; border: 2px solid var(--accent); position: relative;">
                    <span style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--accent); color: #000; font-size: 0.75rem; font-weight: 600; padding: 2px 12px; border-radius: 12px;">POPULAR</span>
                    <h3 style="margin-top: 0;">500 credits</h3>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--accent); margin: 1rem 0;">$10</div>
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;">$0.02 per credit</div>
                    <button class="btn btn-primary" id="buy-500" style="width: 100%;" data-i18n="buy_btn">Buy</button>
                </div>
                <div class="card" style="padding: 1.5rem; text-align: center;">
                    <h3 style="margin-top: 0;">1000 credits</h3>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--accent); margin: 1rem 0;">$100</div>
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;">$0.1 per credit</div>
                    <button class="btn btn-primary" id="buy-1000" style="width: 100%;" data-i18n="buy_btn">Buy</button>
                </div>
            </div>

            <!-- Feedback Form Section -->
            <div id="feedback-section" class="card hidden" style="padding: 2rem; margin-top: 1rem;">
                <h2 style="margin-top: 0;" data-i18n="feedback_title">Leave Feedback</h2>
                <div style="margin-top: 1rem;">
                    <textarea id="feedback-text" style="width: 100%; min-height: 120px; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-primary); font-family: inherit; resize: vertical;" placeholder="What do you think about the RIG? What should we improve?"></textarea>
                    <button class="btn btn-primary" id="btn-submit-feedback" style="margin-top: 1rem;" data-i18n="feedback_submit">Submit Feedback</button>
                </div>
            </div>

            <!-- Feedback List Section -->
            <div class="card" style="padding: 2rem; margin-top: 1rem;">
                <h2 style="margin-top: 0;" data-i18n="feedback_list_title">User Feedback</h2>
                <div id="feedback-list" style="margin-top: 1rem; display: flex; flex-direction: column; gap: 1rem;">
                    <div style="color: var(--text-muted);" data-i18n="feedback_loading">Loading feedback...</div>
                </div>
            </div>

            <div class="card" style="padding: 2rem; margin-top: 1rem;">
                <h2 style="margin-top: 0;" data-i18n="api_access_title">API Access</h2>
                <p style="color: var(--text-secondary);" data-i18n="api_access_desc">
                    Generate an API key to use AutoRig REST API from external tools.
                </p>

                <div style="display:flex; gap: 0.75rem; align-items:center; flex-wrap: wrap; margin-top: 1rem;">
                    <button class="btn btn-secondary" id="btn-generate-key" data-i18n="api_access_generate">Generate API Key</button>
                    <button class="btn btn-ghost" id="btn-refresh-keys" data-i18n="api_access_refresh">Refresh</button>
                </div>

                <div id="api-key-once" class="alert alert-info hidden" style="margin-top: 1rem;">
                    <div style="display:flex; gap: 0.75rem; align-items:center; justify-content: space-between; flex-wrap: wrap;">
                        <div>
                            <div style="font-weight: 600;" data-i18n="api_access_key_once">Your API key (shown once):</div>
                            <code id="api-key-plain" style="display:block; margin-top:0.5rem; word-break: break-all;"></code>
                        </div>
                        <button class="btn btn-ghost" id="btn-copy-key" data-i18n="btn_copy">Copy</button>
                    </div>
                </div>

                <div style="margin-top: 1rem;">
                    <div style="font-weight:600; margin-bottom: 0.5rem;" data-i18n="api_access_keys">Your keys</div>
                    <div id="api-keys-list" style="color: var(--text-muted);">-</div>
                </div>
            </div>
        </div>
    </main>

        <!-- SEO Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <!-- Brand Column -->
                <div class="footer-brand">
                    <a href="/" class="footer-logo">
                        <img src="/static/images/logo/autorig-logo.png" alt="AutoRig Online" height="60">
                    </a>
                    <p class="footer-tagline" data-i18n="footer_tagline">AI-powered automatic 3D character rigging. Upload your model and get it rigged with animations in minutes.</p>
                </div>
                
                <!-- Services Column -->
                <div class="footer-links">
                    <h4 class="footer-heading" data-i18n="footer_services">Services</h4>
                    <ul>
                        <li><a href="/glb-auto-rig" data-i18n="footer_glb_rig">GLB Auto Rigging</a></li>
                        <li><a href="/fbx-auto-rig" data-i18n="footer_fbx_rig">FBX Auto Rigging</a></li>
                        <li><a href="/obj-auto-rig" data-i18n="footer_obj_rig">OBJ Auto Rigging</a></li>
                        <li><a href="/gallery" data-i18n="nav_gallery">Gallery</a></li>
                    </ul>
                </div>
                
                <!-- Guides Column -->
                <div class="footer-links">
                    <h4 class="footer-heading" data-i18n="footer_guides">Guides</h4>
                    <ul>
                        <li><a href="/mixamo-alternative" data-i18n="footer_mixamo_alt">Mixamo Alternative</a></li>
                        <li><a href="/rig-glb-unity" data-i18n="footer_glb_unity">GLB for Unity</a></li>
                        <li><a href="/rig-fbx-unreal" data-i18n="footer_fbx_unreal">FBX for Unreal</a></li>
                        <li><a href="/glb-vs-fbx" data-i18n="footer_glb_vs_fbx">GLB vs FBX</a></li>
                        <li><a href="/t-pose-vs-a-pose" data-i18n="footer_tpose">T-Pose vs A-Pose</a></li>
                        <li><a href="/animation-retargeting" data-i18n="footer_retargeting">Animation Retargeting</a></li>
                    </ul>
                </div>
                
                <!-- Company Column -->
                <div class="footer-links">
                    <h4 class="footer-heading" data-i18n="footer_company">Company</h4>
                    <ul>
                        <li><a href="/guides" data-i18n="nav_guides">All Guides</a></li>
                        <li><a href="/how-it-works" data-i18n="footer_how_it_works">How It Works</a></li>
                        <li><a href="/faq" data-i18n="footer_faq">FAQ</a></li>
                        <li><a href="/buy-credits" data-i18n="nav_buy">Buy Credits</a></li>
                        <li><a href="/developers" data-i18n="nav_api">API</a></li>
                    </ul>
                </div>
            </div>
            
            <!-- Bottom Bar -->
            <div class="footer-bottom">
                <p class="footer-copyright" data-i18n="footer_copyright">¬© 2025 AutoRig Online. All rights reserved.</p>
                <div class="footer-social">
                    <a href="https://t.me/autorigonline" target="_blank" rel="noopener noreferrer" class="footer-social-link" title="Telegram">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                        </svg>
                        <span>Telegram</span>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script src="/static/js/i18n.js"></script>
    <script>
        async function loadAuth() {
            const resp = await fetch('/auth/me');
            return await resp.json();
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('autorig_theme', theme);
            const toggle = document.getElementById('theme-toggle');
            if (toggle) toggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        function setupThemeToggle() {
            const savedTheme = localStorage.getItem('autorig_theme') || 'dark';
            setTheme(savedTheme);
            const toggle = document.getElementById('theme-toggle');
            toggle?.addEventListener('click', () => {
                const current = document.documentElement.getAttribute('data-theme');
                setTheme(current === 'dark' ? 'light' : 'dark');
            });
        }

        function setupLangSelector() {
            const btn = document.querySelector('.lang-btn');
            const dropdown = document.querySelector('.lang-dropdown');
            btn?.addEventListener('click', () => dropdown?.classList.toggle('open'));
            document.querySelectorAll('.lang-option').forEach(opt => {
                opt.addEventListener('click', async () => {
                    const lang = opt.getAttribute('data-lang');
                    await I18n.setLanguage(lang);
                    dropdown?.classList.remove('open');
                });
            });
        }

        async function updateCreditsUI() {
            try {
                const data = await loadAuth();
                const creditsEl = document.getElementById('credits-count');
                const labelEl = document.getElementById('credits-label');
                if (labelEl) labelEl.textContent = t('credits_remaining');
                if (creditsEl) creditsEl.textContent = data.credits_remaining ?? '-';
                window.__authedUser = data.user || null;
                
                // Show feedback section if logged in
                if (window.__authedUser) {
                    document.getElementById('feedback-section')?.classList.remove('hidden');
                }
            } catch (e) {
                console.error('Auth load failed:', e);
            }
        }

        async function setupYouTubeBonus() {
            const link = document.getElementById('youtube-bonus-link');
            link?.addEventListener('click', async (e) => {
                if (!window.__authedUser) {
                    alert(t('buy_login_required'));
                    e.preventDefault();
                    return;
                }
                
                // Call API to grant bonus
                try {
                    const resp = await fetch('/api/user/grant-youtube-bonus', { method: 'POST' });
                    const data = await resp.json();
                    if (data.ok) {
                        alert(t('youtube_bonus_success'));
                        await updateCreditsUI();
                    } else if (data.already_received) {
                        alert(t('youtube_bonus_already'));
                    }
                } catch (e) {
                    console.error('YouTube bonus failed:', e);
                }
            });
        }

        async function loadFeedback() {
            const listEl = document.getElementById('feedback-list');
            try {
                const resp = await fetch('/api/feedback');
                const data = await resp.json();
                if (!data.items || data.items.length === 0) {
                    listEl.innerHTML = `<div style="color: var(--text-muted);">${t('feedback_empty')}</div>`;
                    return;
                }
                
                const isAdmin = window.__authedUser?.is_admin;
                
                listEl.innerHTML = data.items.map(item => `
                    <div class="card" style="padding: 1rem; background: rgba(255,255,255,0.03);">
                        <div style="display:flex; justify-content: space-between; align-items: flex-start; gap: 1rem;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; font-size: 0.9rem; color: var(--accent);">${item.user_name}</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.5rem;">${new Date(item.created_at).toLocaleString()}</div>
                                <div style="white-space: pre-wrap; line-height: 1.5;">${item.text}</div>
                            </div>
                            ${isAdmin ? `<button class="btn btn-ghost" style="color: #ef4444; padding: 0.25rem 0.5rem;" onclick="deleteFeedback(${item.id})">Delete</button>` : ''}
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('Load feedback failed:', e);
                listEl.innerHTML = `<div style="color: #ef4444;">Failed to load feedback</div>`;
            }
        }

        async function deleteFeedback(id) {
            if (!confirm('Delete this feedback?')) return;
            try {
                const resp = await fetch(`/api/feedback/${id}`, { method: 'DELETE' });
                if (resp.ok) {
                    await loadFeedback();
                }
            } catch (e) {
                console.error('Delete feedback failed:', e);
            }
        }
        window.deleteFeedback = deleteFeedback;

        function setupFeedbackForm() {
            const btn = document.getElementById('btn-submit-feedback');
            const textarea = document.getElementById('feedback-text');
            btn?.addEventListener('click', async () => {
                const text = textarea.value.trim();
                if (!text) return;
                
                btn.disabled = true;
                try {
                    const resp = await fetch('/api/user/feedback', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text })
                    });
                    if (resp.ok) {
                        textarea.value = '';
                        alert(t('feedback_success'));
                        await loadFeedback();
                    }
                } catch (e) {
                    console.error('Feedback submit failed:', e);
                } finally {
                    btn.disabled = false;
                }
            });
        }

        function gumroadUrl(permalink, useridEmail) {
            const base = `https://u3d.gumroad.com/l/${permalink}`;
            const params = new URLSearchParams();
            if (useridEmail) params.set('userid', useridEmail);
            return `${base}?${params.toString()}`;
        }

        function setupBuyButtons() {
            const getUserid = () => (window.__authedUser && window.__authedUser.email) ? window.__authedUser.email : '';
            
            const packageInfo = {
                'autorig-100': { credits: '100', price: '$1' },
                'autorig-500': { credits: '500', price: '$10' },
                'autorig-1000': { credits: '1000', price: '$100' }
            };
            
            const go = (p) => {
                const uid = getUserid();
                if (!uid) {
                    alert(t('buy_login_required'));
                    window.location.href = '/auth/login';
                    return;
                }
                
                // Send Telegram notification (fire-and-forget)
                const info = packageInfo[p] || { credits: p, price: 'unknown' };
                fetch('/api/notify/credits-click', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ package: `${info.credits} credits`, price: info.price })
                }).catch(() => {}); // ignore errors
                
                window.location.href = gumroadUrl(p, uid);
            };
            document.getElementById('buy-100')?.addEventListener('click', () => go('autorig-100'));
            document.getElementById('buy-500')?.addEventListener('click', () => go('autorig-500'));
            document.getElementById('buy-1000')?.addEventListener('click', () => go('autorig-1000'));
        }

        async function loadApiKeys() {
            const listEl = document.getElementById('api-keys-list');
            listEl.textContent = t('api_access_loading');
            const resp = await fetch('/api/user/api-keys');
            if (!resp.ok) {
                listEl.textContent = t('api_access_login_required');
                return;
            }
            const data = await resp.json();
            if (!data.keys || data.keys.length === 0) {
                listEl.textContent = t('api_access_no_keys');
                return;
            }
            listEl.innerHTML = data.keys.map(k => {
                const revoked = k.revoked_at ? ' (revoked)' : '';
                return `
                    <div style="display:flex; align-items:center; justify-content: space-between; gap: 1rem; padding: 0.5rem 0; border-bottom: 1px solid var(--border);">
                        <div>
                            <div><span style="color: var(--text-secondary);">ar_${k.key_prefix}_‚Ä¶</span>${revoked}</div>
                            <div style="color: var(--text-muted); font-size: 0.85rem;">${new Date(k.created_at).toLocaleString()}</div>
                        </div>
                        ${k.revoked_at ? '' : `<button class="btn btn-ghost" data-key-id="${k.id}">${t('api_access_revoke')}</button>`}
                    </div>
                `;
            }).join('');
            listEl.querySelectorAll('button[data-key-id]').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const id = btn.getAttribute('data-key-id');
                    if (!confirm(t('api_access_revoke_confirm'))) return;
                    await fetch(`/api/user/api-keys/${id}/revoke`, { method: 'POST' });
                    await loadApiKeys();
                });
            });
        }

        async function generateApiKey() {
            const resp = await fetch('/api/user/api-keys', { method: 'POST' });
            if (!resp.ok) {
                alert(t('api_access_login_required'));
                window.location.href = '/auth/login';
                return;
            }
            const data = await resp.json();
            const box = document.getElementById('api-key-once');
            const code = document.getElementById('api-key-plain');
            code.textContent = data.api_key;
            box.classList.remove('hidden');
            await loadApiKeys();
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await I18n.init();
            setupThemeToggle();
            setupLangSelector();
            await updateCreditsUI();
            setupBuyButtons();
            setupYouTubeBonus();
            setupFeedbackForm();
            await loadFeedback();

            document.getElementById('btn-refresh-keys')?.addEventListener('click', loadApiKeys);
            document.getElementById('btn-generate-key')?.addEventListener('click', generateApiKey);
            document.getElementById('btn-copy-key')?.addEventListener('click', async () => {
                const v = document.getElementById('api-key-plain').textContent;
                await navigator.clipboard.writeText(v);
                alert(t('api_access_copied'));
            });

            await loadApiKeys();
        });
    </script>
</body>
</html>

