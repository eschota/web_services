# –°–∏—Å—Ç–µ–º–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ—Å–≤–µ—â–µ–Ω–∏—è 3D Viewer'–∞

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–º–∏–Ω–∞–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Å–≤–µ—â–µ–Ω–∏—è –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –≤–æ –≤—Å–µ—Ö viewer'–∞—Ö.

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –î–ª—è –∞–¥–º–∏–Ω–æ–≤:

1. **–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å email –∏–∑ `ADMIN_EMAIL` (config.py)
2. **–û—Ç–∫—Ä—ã—Ç—å –ª—é–±—É—é –º–æ–¥–µ–ª—å** –≤ 3D viewer'–µ
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Å–≤–µ—â–µ–Ω–∏–µ:**
   - Ambient light (—Ü–≤–µ—Ç –∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å)
   - Fog (—Ü–≤–µ—Ç –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç—å)
   - Sun position (rotation, inclination)
   - Bloom —ç—Ñ—Ñ–µ–∫—Ç—ã
   - Background color
   - –ò –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Å–≤–µ—â–µ–Ω–∏—è

4. **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ:**
   - –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É **Z** –≤ —Ü–µ–Ω—Ç—Ä–µ —Å–Ω–∏–∑—É viewer'–∞
   - –ò–ª–∏ –Ω–∞–∂–∞—Ç—å –∫–ª–∞–≤–∏—à—É **Z** –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª `/var/autorig/viewer_default_settings.json`
- –í—Å–µ –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç —Å–≤–æ–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Backend API:
```bash
GET  /api/viewer-default-settings      # –ß—Ç–µ–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
POST /api/admin/viewer-default-settings # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)
```

### Frontend:
- –ö–Ω–æ–ø–∫–∞ **Z** –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º
- –§—É–Ω–∫—Ü–∏—è `saveDefaultViewerSettings()` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—É—â–∏–π `viewerState`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤ —á–µ—Ä–µ–∑ `/auth/me` endpoint

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```json
{
  "mainLightIntensity": 3.0,
  "ambientColor": "#ffffff",
  "ambientIntensity": 0.3,
  "fogColor": "#000000",
  "fogDensity": 0.0,
  "sunRotation": 45.0,
  "sunInclination": 45.0,
  "bloom": {"strength": 0.0, "threshold": 0.8, "radius": 0.4},
  // ... –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Å–≤–µ—â–µ–Ω–∏—è
}
```

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ Z –Ω–µ –≤–∏–¥–Ω–∞:
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ö–æ–¥ –∫–∞–∫ –∞–¥–º–∏–Ω:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–æ—à–ª–∏ –ø–æ–¥ email –∏–∑ `ADMIN_EMAIL` (config.py)
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞

2. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:**
   ```javascript
   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç
   if (window.ensureViewerAdmin) {
       window.ensureViewerAdmin().then(isAdmin => {
           console.log('Admin status:', isAdmin);
           fetch('/auth/me').then(r => r.json()).then(d => console.log('Auth data:', d));
       });
   }
   ```

3. **–ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ debug —Å–∫—Ä–∏–ø—Ç:**
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `debug_admin_test.js` –≤ –∫–æ–Ω—Å–æ–ª—å
   - –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É üîç (–µ—Å–ª–∏ –≤–∏–¥–Ω–∞) –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –ï—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏ API (`Failed to save default settings`)
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª `/var/autorig/viewer_default_settings.json` –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
// 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∞–¥–º–∏–Ω–∞
window.ensureViewerAdmin().then(console.log);

// 2. –†—É—á–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
window.saveDefaultViewerSettings('console-test');

// 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API
fetch('/api/viewer-default-settings').then(r => r.json()).then(console.log);
```

### –ï—Å–ª–∏ –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —á–∏—Ç–∞–µ–º
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `loadViewerSettings()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: task-specific settings > global defaults > hardcoded defaults

## –§–∞–π–ª—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

- **Backend:** `/root/autorig-online/backend/main.py` (API endpoints)
- **Frontend:** `/root/autorig-online/static/task.html` (–∫–Ω–æ–ø–∫–∞ –∏ –ª–æ–≥–∏–∫–∞)
- **Config:** `/root/autorig-online/backend/config.py` (–ø—É—Ç—å –∫ —Ñ–∞–π–ª—É)
- **Defaults:** `/root/autorig-online/backend/main.py` (DEFAULT_VIEWER_SETTINGS)

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéØ‚ú®